/**
 * Handles the search functionality by filtering and highlighting results based on the search value.
 * This function performs the following:
 * - Filters subjects, chapters, and topics based on the search value.
 * - Highlights the search value in the result items.
 * - Updates the search dropdown with the results or a "no data found" message.
 *
 * @param {Object} _this - The context object containing user data.
 * @param {string} val - The search value to filter results.
 */
export function handle_search(_this, val) {
    const searchValue = val.toLowerCase();
    const resultArr = [
        ..._this.user_data.subjects.filter(subject => subject.name.toLowerCase().includes(searchValue)),
        ..._this.user_data.chapters.filter(chapter => chapter.name.toLowerCase().includes(searchValue)),
        ..._this.user_data.topics.filter(topic => topic.name.toLowerCase().includes(searchValue))
    ];

    const all_search_item_html = resultArr.length 
        ? resultArr.map(item => {
            const regExp = new RegExp(searchValue, 'i');
            const highlightedName = item.name.replace(regExp, `<span class='text-info'>${val}</span>`);
            const baseHtml = {
                'subject': `<li class="d-block text-truncate"><i class="fa-solid fa-book d-inline me-2 fnx-9"></i><a class="d-inline link" data-type='${item.type}' data-name='${item.name}'>${highlightedName}</a></li>`,
                'chapter': `<li class="d-block text-truncate"><i class="fa-solid fa-play d-inline me-2 fnx-9"></i><a class="d-inline link" data-type='${item.type}' data-name='${item.name}' data-subject='${item.subject}'>${highlightedName}<span class="fnx-6 mx-1">${item.subject}</span></a></li>`,
                'topic': `<li class="d-block text-truncate"><i class="fa-solid fa-bookmark d-inline me-2 fnx-9"></i><a class="d-inline link" data-type='${item.type}' data-name='${item.name}' data-chapter='${item.chapter}' data-subject='${item.subject}'>${highlightedName}<span class="fnx-6 mx-1">${item.subject}/${item.chapter}</span></a></li>`
            };
            return baseHtml[item.type] || '';
        }).join('')
        : '<p class="text-center">No data found</p>';

    html('#nav-search-dropdown ul', all_search_item_html);
}
